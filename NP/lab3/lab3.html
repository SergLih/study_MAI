<html>

  <head>
    <title>–ó–∞–¥–∞–Ω–∏–µ 3</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  </head>

  <body>

    <div class="text-center">
      <h2>–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è #3</h2>
      <h3>–ê–≤—Ç–æ—Ä - –õ–∏—Ö–∞—Ä–µ–≤ –°–µ—Ä–≥–µ–π –°–µ—Ä–≥–µ–µ–≤–∏—á</h3>
      <p>
        –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –Ω–∞ LocalStorage

        –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –¥–æ–ª–∂–µ–Ω <br />
        1) –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ –≤–∏–¥–µ —Ç–∞–±–ª–∏—Ü—ã (0) <br />
        2) —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–µ–π (4). –ü–µ—Ä–≤–æ–µ –ø–æ–ª–µ –∫–ª—é—á–µ–≤–æ–µ. <br />
        3) –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –ø–æ –Ω–∞–∂–∞—Ç–∏—é Enter –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–º –ø–æ–ª–µ (0) <br />
        4) –ø–æ–∑–≤–æ–ª—è—Ç—å —É–¥–∞–ª—è—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã c) –ø–æ –∫–Ω–æ–ø–∫–µ —É –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ (3) <br />
        5) –ø–æ–∑–≤–æ–ª—è—Ç—å –∏–∑–º–µ–Ω—è—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (–ø—Ä–∏–¥—É–º–∞—Ç—å –∫–∞–∫) <br />
      </p>


      <div>
        <form id="form1">
          <input type="text" id="key" placeholder="–ò–º—è" value="A" style="width: 40px;"/>
          <input type="text" id="field1" placeholder="–•" value="1" style="width: 40px;"/>
          <input type="text" id="field2" placeholder="Y" value="2" style="width: 40px;"/>
          <input type="text" id="field3" placeholder="Z" value="3" style="width: 40px;"/>
          
          <input type="button" id="addBtn" value="–î–æ–±–∞–≤–∏—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É" onclick="addValue()">
          <input type="button" id="clearBtn" value="–û—á–∏—Å—Ç–∏—Ç—å" onclick="clearTable()">
        </form>
      </div><br />

      <table id="table" border="1" cellspacing="0" width="300">
      </table>


    </div>

    <script type="text/javascript">
    	var itemsArray;
    	if (localStorage.getItem("items") === null) 
			itemsArray = {};
		else
			itemsArray = JSON.parse(localStorage.getItem("items"));
    	
		document.getElementById("field3").addEventListener(
			'keyup', ({key}) => { if (key === "Enter") addValue();
		})

		outputTable();

		function updateLocalStorage() {
			localStorage.setItem("items", JSON.stringify(itemsArray));
		}

    	function outputTable() {
	    	var table = document.getElementById("table");
	    	var s = "<tr><th>–¢–æ—á–∫–∞</th><td>X</td><td>Y</td><td>Z</td><td></td></tr>";
	    	Object.entries(itemsArray).forEach(entry => {
			  const [key, val] = entry;
			  s += `<tr><th>${key}</th>` 
	        		  + `<td>${val['x']}</td>`
	                  + `<td>${val['y']}</td>`
	                  + `<td>${val['z']}</td>`
	                  + `<td><button onclick="removeItem('${key}')">‚ùå</button>`
	                  + `<button onclick="editItem('${key}')">üñä</button></td>`
	                  + `</tr>`;    		
			});
			table.innerHTML = s;
    	}

      function addValue() {
        
        var f = document.forms.form1;
        var key = f.elements.key.value, 
        	x0 = f.elements.field1.value,
            y0 = f.elements.field2.value,
            z0 = f.elements.field3.value;

        if (key in itemsArray) 
        	alert('–¢–∞–∫–æ–π –∫–ª—é—á —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ');
        else {
        	itemsArray[key] = {x: x0, y: y0, z: z0};	// Model
        	updateLocalStorage(); 						// Model
        	outputTable();		   						// View
        }
        f.elements.key.value = f.elements.field1.value = f.elements.field2.value = f.elements.field3.value = "";
    }


      function clearTable() {
      	itemsArray = {};
      	updateLocalStorage(); 						// Model
        outputTable();		   						// View
      }

      function removeItem(key) {
      	console.log('remove');
      	delete itemsArray[key];						// Model
      	updateLocalStorage(); 						// Model
        outputTable();		   						// View
      }

      function editItem(key) {
      	console.log('change');
      	var x0 = prompt('–ù–æ–≤–∞—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ X: ');
      	var y0 = prompt('–ù–æ–≤–∞—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Y: ');
      	var z0 = prompt('–ù–æ–≤–∞—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Z: ');

      	itemsArray[key] = {x : x0, y: y0, z: z0};   // Model
      	updateLocalStorage(); 						// Model
        outputTable();		   						// View
      }


    </script>

  </body>

</html>
